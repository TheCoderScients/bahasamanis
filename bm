#!/usr/bin/env python3
# simple CLI for BahasaManis: bm run file.bm | bm transpile file.bm
import sys, argparse
from bahasamanis import Interpreter, transpile_to_python

def cmd_run(path):
    with open(path, 'r', encoding='utf-8') as f: src=f.read()
    interp = Interpreter()
    try:
        interp.run(src)
    except Exception as e:
        print('Error:', e, file=sys.stderr)

def cmd_transpile(path, out=None):
    with open(path,'r',encoding='utf-8') as f: src=f.read()
    py = transpile_to_python(src)
    if out:
        with open(out,'w',encoding='utf-8') as f: f.write(py)
        print('Saved ->', out)
    else:
        print(py)

def main():
    p = argparse.ArgumentParser()
    p.add_argument('action', choices=['run','transpile'])
    p.add_argument('file')
    p.add_argument('--out', '-o', help='output file (for transpile)')
    a = p.parse_args()
    if a.action == 'run':
        cmd_run(a.file)
    else:
        cmd_transpile(a.file, a.out)

if __name__=='__main__':
    main()
